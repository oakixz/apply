<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
    <style>
        
        body {
            font-family: sans-serif;
            margin: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f4f4f4;
        }

        .btn {
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn:hover {
            background: #1d4ed8;
        }

        @media print {

            .btn,
            .no-print {
                display: none;
            }

            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ print */
        }
    </style>
</head>

<body>

    <h2>üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</h2>
    <div class="no-print">
        <!-- <button class="btn" onclick="goBack()">‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button> -->
        <label>‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" id="startDate"></label>
        <label>‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" id="endDate"></label>
        <button class="btn" onclick="applyFilter()">üîç ‡∏Å‡∏£‡∏≠‡∏á</button>
        <button class="btn" onclick="printTable()">üñ®Ô∏è Print</button>
    </div>

    <div id="printArea">
        <table>
            <thead>
                <tr>
                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                    <th>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                </tr>
            </thead>
            <tbody id="attendanceTable">
                <!-- JS ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
            </tbody>
        </table>
    </div>

    <script src="/frontend/config/path.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const userid = params.get("userid");

        let allData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á

        async function loadAttendance() {
            try {
                const res = await fetch(`${api_teacher}/listtable?userid=${userid}`, {
                    credentials: "include",
                });
                const data = await res.json();

                allData = data.data || [];
                renderTable(allData);
            } catch (err) {
                console.error("Error loadAttendance:", err);
            }
        }

        function renderTable(rows) {
            const tbody = document.getElementById("attendanceTable");
            tbody.innerHTML = "";

            if (!rows || rows.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
                return;
            }

            rows.forEach((row, index) => {
                let approveText = "";
                switch (row.approve) {
                    case "Y":
                        approveText = "‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
                        break;
                    case "N":
                        approveText = "‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
                        break;
                    case "P":
                    default:
                        approveText = "‚åõ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£";
                }

                const tr = document.createElement("tr");
                tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${new Date(row.date).toLocaleDateString("th-TH")}</td>
      <td>${row.status}</td>
      <td>${row.note || "-"}</td>
      <td>${approveText}</td>
    `;
                tbody.appendChild(tr);
            });
        }

        function applyFilter() {
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            if (!startDate && !endDate) {
                renderTable(allData); // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏≠‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                return;
            }

            const filtered = allData.filter(row => {
                const rowDate = new Date(row.date);
                const from = startDate ? new Date(startDate) : null;
                const to = endDate ? new Date(endDate) : null;

                if (from && rowDate < from) return false;
                if (to && rowDate > to) return false;
                return true;
            });

            renderTable(filtered);
        }

        function goBack() {
            window.history.back();
        }

        function printTable() {
            window.print();
        }

        loadAttendance();

    </script>

</body>

</html>